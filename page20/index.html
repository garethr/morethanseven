<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      More than seven &middot; Gareth Rushgrove
    
  </title>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-435455-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>



  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
   <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=morethansevennet" id="_carbonads_js"></script>

   <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          More than seven
        </a>
      </h1>
      <p class="lead">Writing about code. Occasional other topics. Made by <a href="https://twitter.com/garethr">@garethr</a>.</p>
    </div>
  </div>
</div>


    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2010/03/08/Piston-and-sanitising-json-callbacks/">
        Piston And Sanitising Json Callbacks
      </a>
    </h1>

    <span class="post-date">08 Mar 2010</span>

    <p>I&#8217;m a big fan of <a href="http://bitbucket.org/jespern/django-piston">Piston</a>, the django app for creating RESTful web services. As part of a project at work I ended up looking through the source code, mainly at some of the neat tricks of serialisation of objects. While poking around I came across something in my mind that wanted fixing. This being open source rather than just file a bug report I setup a <a href="http://bitbucket.org">bitbucket</a> account and got hacking.</p>
<% syntax_colorize :python, type=:coderay do %>
def render(self, request):
	cb = request.GET.get('callback')
        seria = simplejson.dumps(self.construct(),
		cls=DateTimeAwareJSONEncoder,
		ensure_ascii=False, indent=4)

        # Callback
        if cb:
            return '%s(%s)' % (cb, seria)

        return seria
<% end %>
<p>Can you spot the problem? Note the use of the callback passed in the query string arguments and then used <em>without any checking</em> in the output.</p>
<p>What we really want to do is something like this:</p>
<% syntax_colorize :python, type=:coderay do %>
if is_valid_jsonp_callback_value(cb):
<% end %>
<p>Which is exactly what has just <a href="http://bitbucket.org/jespern/django-piston/changeset/f558b2c66dcc/">gone into the code for Piston</a>. <a href="http://tav.espians.com/sanitising-jsonp-callback-identifiers-for-security.html">This article</a> contains lots of background information about why <span class="caps">JSONP</span> callbacks can be a security hole, and helpfully provides a <a href="http://github.com/tav/scripts/blob/master/validate_jsonp.py">nice Python module</a> to help with the sanitisation. Nice to be on the authors list for something I&#8217;m using actively.</p>
<p>Thanks to <a href="http://twitter.com/jespern">Jesper Noehr</a> for Piston, for some pointers on bitbucket and for quickly taking the patch. If you&#8217;re accepting a callback on your site or application, especially if it&#8217;s a public service, you really want to do something like this or you just might have an exploitable security hole.</p>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2010/03/07/New-nanoc-powered-blog/">
        New Nanoc Powered Blog
      </a>
    </h1>

    <span class="post-date">07 Mar 2010</span>

    <p>It&#8217;s taken longer than I would have liked but I&#8217;ve finally gotten around to relaunching this site on <a href="http://nanoc.stoneship.org/">nanoc</a>.</p>
<p>After looking through lots of code from the <a href="http://projects.stoneship.org/trac/nanoc/wiki/Showcase">nanoc showcase</a> I had a pretty good feel for how I wanted things to work and I then used the excellent <a href="http://github.com/mgutz/nanoc3_blog">nanoc3_blog</a> template to get started. I&#8217;ve hacked around quite a bit with the code to get things how I wanted them. Using <a href="http://lesscss.org/">Less</a> to make the <span class="caps">CSS</span> more manageable, <a href="http://coderay.rubychan.de/">Coderay</a> for lovely syntax highlighting and making everything default to textile rather than markdown. I&#8217;ve also written import scripts for my old blog (in Python) and another one so I can use tumblr is I want to create items on here (in Ruby).</p>
<p>Nanoc really is a joy to work with and I&#8217;m hoping that alone will get me back into writing more freqently than I have done for a while. The fact I can just write in Vim or WriteRoom or whatever editor I have to hand feels nice. And using Git, Rake and Rsync complete my little toolset. Everything is still served via Nginx.</p>
<p>I&#8217;ve thrown the all the code, including all the content, up on <a href="http://github.com/garethr/morethanseven">GitHub</a> for anyone interested. Back to writing.</p>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2010/03/07/Mysql-support-for-cucumber-nagios/">
        Mysql Support For Cucumber Nagios
      </a>
    </h1>

    <span class="post-date">07 Mar 2010</span>

    <p>I just noticed Lindsay had <a href="http://github.com/auxesis/cucumber-nagios">committed</a> the amqp steps for cucumber-nagios and remembered I hadn&#8217;t mentioned on here some other work I&#8217;ve been doing on the same project. We use MySQL quite a bit at work and I&#8217;ve been wanting to extent our monitoring for a while. So I set about thinking how that would work with cucumber-nagios. What I&#8217;ve come up with looks something like this:</p>
<pre>
Feature: localhost
  To make sure the rest of the system is in order
  Our database server should not be overloaded

  Scenario: check running processes count
    Given I have a MySQL server on localhost
    And I use the username root
    Then it should have less than 10 processes

  Scenario: check queries per second
    Given I have a MySQL server on localhost
    And I use the username root
    Then it should have less than 200 select queries per second
    Then it should have less than 300 queries per second
    Then it should have less than 5 slow queries pers second
    Then it should have at least 10 queries per second
</pre>
<p>The numbers, username details and host details are all variables. So you can write senarios for your specific deployments. The tests over time are based on a very short lived sampling mechanic which I&#8217;ve yet to test in anger. I&#8217;m not sure just yet is this approach will lead to too many false positives but we&#8217;ll have to see.</p>
<p>This <a href="http://codeinthehole.com/archives/8-Monitoring-MySQL-with-Ganglia-and-gmetric.html">mysql gmetric script</a> gave me lots of the ideas for invidual steps. I&#8217;ll be writing more about some work I&#8217;ve been doing with cucumber-nagios and ganglia soon as well.</p>
<p>For the moment if anyone want&#8217;s to try these steps out you can either check out <a href="http://github.com/garethr/cucumber-nagios">my cucumber-nagios</a> fork or just grab the steps from the <a href="http://github.com/garethr/cucumber-nagios/blob/master/lib/generators/project/features/steps/mysql_steps.rb">mysql_steps.rb</a> file. Any feedback much appreciated.</p>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2010/02/15/blogging-platforms/">
        On blogging platforms
      </a>
    </h1>

    <span class="post-date">15 Feb 2010</span>

    <p>Every now and again I feel the need for a change and spent a little time tonight looking at different blogging software. I&#8217;m currently running a custom django app I wrote a good while ago, more as an excuse to play with Django than anything. Previously I&#8217;ve used Wordpress, Textpattern and even Radiant. But I&#8217;m coming to the conclusion that what I want doesn&#8217;t exist. In theory that means an opportunity for someone to enter the market, in reality I think it might just be me. So, what do I want?</p>
<ul>
	<li>Customisable <span class="caps">URL</span> patterns and redirects. Tumblr did well until this point but I have years of content on nice URLs and I&#8217;d not going to throw that away.</li>
	<li>Command line interface for posting snippets</li>
	<li>Nice looking web based <span class="caps">API</span> (bonus points to Typepad here for some nifty features like pubsubhubhub)</li>
	<li>iPod touch app</li>
	<li>Real control over the design, not just pre-made templates unless you pay for a pro account</li>
	<li>Hackable (this could mean anything, but I know it when I see it. So not WordPress then.)</li>
	<li>Export plain text out</li>
	<li>Use my own domain name</li>
</ul>
<p>I have a sneaking suspicion what I might be thinking about is a private tumblr blog used as a datasource for <a href="http://nanoc.stoneship.org/">Nanoc3</a>. But that relies on me having the time to build that as I can&#8217;t find anyone who might have written such a think. Maybe one day.</p>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2010/02/11/djugl-february/">
        DJUGL February
      </a>
    </h1>

    <span class="post-date">11 Feb 2010</span>

    <p>The next Django User Group London is in two weeks time. You can register over on <a href="http://londonpython.eventwax.com/djugl-february">Eventwax</a>. So far we have <a href="http://intranation.com">Brad</a> talking with more speakers to be announced shortly. Hope to see a few people there.</p>
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page21">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page19">Newer</a>
    
  
</div>
    </div>

  </body>
</html>
