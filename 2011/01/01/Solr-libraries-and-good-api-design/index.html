<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Solr Libraries and Good API Design &middot; More than seven
    
  </title>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-435455-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>



  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
   <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=morethansevennet" id="_carbonads_js"></script>

   <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          More than seven
        </a>
      </h1>
      <p class="lead">Writing about code mainly. Occasional other topics. Made by <a href="https://twitter.com/garethr">@garethr</a>.</p>
    </div>
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Solr Libraries and Good API Design</h1>
  <span class="post-date">01 Jan 2011</span>
  <p>I&#8217;m a huge <a href="http://wiki.apache.org/solr/">Solr</a> fan. Once you understand what it does (it&#8217;s a search engine, which means more than you think) and how it works you spot lots of thorny problems that map to it&#8217;s features really well. In my experience it&#8217;s also very fast and very stable once installed and setup. Oh, and the community support is great as well.</p>
<p>When I talk to some folks about Solr all they can think about is full text search. The main reason for this I think is a number of poor libraries. I&#8217;ve come across lots of Python or Ruby libraries that simply say you don&#8217;t have to know anything about Solr, just install this code and you get full text search! This works in the same way as using the default Mysql or Apache configs works, nowhere near as well as if you get your hands dirty even a little. Some of the ruby gems even ship the Solr jar file in the gem. Now you don&#8217;t even need to know Solr exists. You take a generic configuration and run it using a rake task behind which is some unknown Java application server. Good luck debugging that when it goes wrong, that&#8217;s one hell of a leeky abstraction.</p>
<p>In better news I&#8217;ve now found two excellent Solr libraries, one&#8217;s that start with the assumption that you know what you&#8217;re doing or happy to learn about the tools you&#8217;re using. All you really want from a library is a good <span class="caps">API</span> that maps to how you write in that language.</p>
<h2>Delsolr (Ruby)</h2>
<p>The <a href="http://delsolr.rubyforge.org/">delsolr</a> <span class="caps">API</span> is beautiful. It seemlessly merges the worlds of Ruby and Solr in a way that&#8217;s easy to write and easy to guess. It&#8217;s also clever, the design accepts that new features might be added to Solr before the library is updated or that the library might not support every usecase or option. In these cases you can still pass information through to Solr directly.</p>
<p>Solr&#8217;s interface is based around URLs, so any library is really just giving you an interface to creating those URLs.Writing the following in Ruby:</p>
<pre>rsp = solr.query('standard',
               :query =&gt; '*:*',
               :filters =&gt; {:status =&gt; 'Active'},
               :facets =&gt; [{:field =&gt; 'project'}]
    ])</pre>
<p>Results in the following <span class="caps">URL</span>:</p>
<pre>/select?q=*:*&amp;wt=ruby&amp;facet=true&amp;facet.field=status&amp;facet.field=name&amp;fq=status:Active</pre>
<p>If you already know Solr and how to construct URLs for searches by hand you&#8217;ll immediately get the Ruby code. You can probably even guess how to pass other params like sort or order.</p>
<p>Another nice touch is that you can use either hashes or Lucene search syntax for each attribute. So:</p>
<pre>:filters =&gt; {:status =&gt; 'Active'}</pre>
<p>Is the same as:</p>
<pre>:filters =&gt; 'status:Active'</pre>
<h2>Sunburnt (Python)</h2>
<p><a href="http://blog.timetric.com/2010/02/08/sunburnt-a-python-solr-interface">Sunburnt</a> is a python Solr interface from the nice folks at <a href="http://timetric.com">Timetric</a>. I&#8217;ve not had chance to use this library in anger as it was released after I&#8217;d dont quite a bit of python-solr work in an old job but I&#8217;d definately use it now. The <span class="caps">API</span> looks like:</p>
<pre>rsp = solr.query('*:*').filter(status='Active').facet_by('project').execute()</pre>
<p>It&#8217;s based around chaining so again you can probably guess how to make further queries from even this simple example.</p>
<p>Both Sunburnt and Delsolr also support adding documents to the index.</p>
<h2>Uses</h2>
<p>Once you understand facets and the usefulness of filter queries you see lots of places where Solr is useful apart from text search. Lots of ecommerce operations use facetted search interfaces, I&#8217;m sure everyone has spent time clicking through nested heirachies and watching the numbers (showing the number of products) next to the links decrease? You can built these interfaces using <span class="caps">SQL</span> but it&#8217;s incredibly expensive and gets out of hand quickly. Caching only helps a bit due to the number of permutations in all but the smallest stores or simplest products. It&#8217;s a similar problem with tagging, it&#8217;s pretty easy to kill your database</p>
<p>But it&#8217;s not just things that have the word search in that you can map Solr to. Two good examples are Timetric (from whom the Sunburnt library comes from) and the <a href="http://www.guardian.co.uk/open-platform/blog/what-is-powering-the-content-api">Guardian Content <span class="caps">API</span></a>. Both of these present lots of read data straight from Solr with great success and less database killing performance issues. Solr can really be seen as a simple place to denormalise your data, one advantage being that it keeps your database schema clean.</p>
<h2>Learning More</h2>
<p>Solr could do with better documentation for beginners. The wiki is an excellent reference once you know how to write schema and configuration files but I think the getting started section sacrifices introducing configuration in favour of getting people searching quicker. The example schema and solrconfig files that ship with Solr are also amazingly useful references (officially the best commented <span class="caps">XML</span> I&#8217;ve ever seen) but also intimidating to beginners. The Drupal community appear to be writing some good docs that fill this gap though, here&#8217;s a few links that I&#8217;d recommend:</p>
<ul>
	<li><a href="http://www.drupalconnect.com/blog/steve/configuring-apache-solr-multi-core-drupal-and-tomcat-ubuntu-910">Step by step guide including Tomcat</a></li>
	<li><a href="http://synapticloop.com/tomes/solr/solr-tutorial/">Fantastic multi-part tutorial</a></li>
</ul>
</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2014/10/28/docker-puppet-shared-volumes/">
            Docker, Puppet and shared volumes
            <small>28 Oct 2014</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2014/10/12/using-puppet-with-key-value-config-stores/">
            Using Puppet with key/value config stores
            <small>12 Oct 2014</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2014/07/20/leaving-gds-never-easy/">
            Leaving GDS never easy
            <small>20 Jul 2014</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>

  </body>
</html>
