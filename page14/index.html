<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      More than seven &middot; Gareth Rushgrove
    
  </title>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-435455-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>



  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
   <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=morethansevennet" id="_carbonads_js"></script>

   <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          More than seven
        </a>
      </h1>
      <p class="lead">Writing about code mainly. Occasional other topics. Made by <a href="https://twitter.com/garethr">@garethr</a>.</p>
    </div>
  </div>
</div>


    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2011/01/10/My-default-recipes-for-vagrant-virtual-machines/">
        My Default Recipes For Vagrant Virtual Machines
      </a>
    </h1>

    <span class="post-date">10 Jan 2011</span>

    <p>I&#8217;ve written about <a href="http://morethanseven.net/2010/11/04/Why-you-should-be-using-virtualisation.html">Vagrant previously</a> and the more I use it the more it impresses me and the more it changes how I work. For those that haven&#8217;t yet used <a href="http://vagrantup.com">vagrant</a> the brief summary is, it&#8217;s a way of managing, creating and destroying headless virtualbox virtual machines. So when I&#8217;m sat at my computer and I want a new 32 bit virtual machine based on Maverick I just type.</p>
<pre>vagrant init maverick32
vagrant up</pre>
<p>It has some other magic tricks as well, like automatically setting up <span class="caps">NFS</span> shares between the host and guest and allowing you to specify ports to forward in the configuration file. You access the machine via ssh, either using the handy <em>vagrant ssh</em> command or by using <em>vagrant ssh-config</em> to dump the relevant configuration to place in ~/.ssh/config.</p>
<p>I&#8217;ve been using virtualisation for a few years, initially purely for testing and experimentation, and then eventually for all my development. I&#8217;d have a few VMware images, I&#8217;d use snapshots and occasionally rollback, but I very rarely created new virtual machines. It was quite a manual process. With vagrant that&#8217;s changing. Everytime I start investigating a new tool or new technology or work on a pet project I create a new virtual machine. That way I know exactly what I&#8217;m dealing with, and with vagrant the cost of doing that is the 30s waiting for the new machine to boot.</p>
<p>Or rather it would be if I didn&#8217;t then have to install and configure the same few things on every machine. Pretty much whatever I might be doing I found myself installing the same things, namely zsh, vim, git and utils like ack, wget, curl and lynx. This is exactly what the provisioning support in vagrant is for, so I set out to use chef to do this for me.</p>
<p>I decided to use a remote tar file for the recipes. I&#8217;m not really bothered about managing a chef server just for my personal virtual machines, but I did want to have a canonical source of the cookbooks that wasn&#8217;t local to just one of my machines. Plus this means anyone else who shares my opinions about what you want on a new virtual machine can use them too.</p>
<p>My Vagrantfile now looks like this:</p>
<pre>Vagrant::Config.run do |config|
  config.vm.box = "maverick32"
  config.vm.provisioner = :chef_solo
  config.chef.recipe_url = "http://cloud.github.com/downloads/garethr/chef-repo/cookbooks.tar.gz"
  config.chef.add_recipe "garethr"
  config.chef.cookbooks_path = [:vm, "cookbooks"]
  config.chef.json.merge!({ :garethr =&gt; {
      :ohmyzsh =&gt; "https://github.com/garethr/oh-my-zsh.git",
      :dotvim =&gt; "https://github.com/garethr/dotvim.git"
    }})
end</pre>
<p>You can see the cookbook on GitHub at <a href="https://github.com/garethr/chef-repo/">github.com/garethr/chef-repo</a>. By default it uses the <a href="https://github.com/robbyrussell/oh-my-zsh.git">official oh-my-zsh repo</a> and the <a href="https://github.com/jtimberman/dotvim.git">vim configuration from jtimberman</a>. My own versions are very minor personal preference modifications of those. The Vagrantfile example above shows how you can override the defaults and use your own configs instead if you choose.</p>
<p>One question I was asked about this approach was why I didn&#8217;t just create a basebox with all these things installed by default, this would reduce the time taken on first boot as software wouldn&#8217;t have to be installed each time. However it would also mean maintaining the basebox&#8217;s myself, and as I use different Linux distributions or versions this would be a headache. While doing this and working with vagrant I&#8217;ve been thinking about the ecosystem around the tool and I&#8217;m planning on writing my thoughts on that subject over the next week or so.</p>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2011/01/01/Solr-libraries-and-good-api-design/">
        Solr Libraries and Good API Design
      </a>
    </h1>

    <span class="post-date">01 Jan 2011</span>

    <p>I&#8217;m a huge <a href="http://wiki.apache.org/solr/">Solr</a> fan. Once you understand what it does (it&#8217;s a search engine, which means more than you think) and how it works you spot lots of thorny problems that map to it&#8217;s features really well. In my experience it&#8217;s also very fast and very stable once installed and setup. Oh, and the community support is great as well.</p>
<p>When I talk to some folks about Solr all they can think about is full text search. The main reason for this I think is a number of poor libraries. I&#8217;ve come across lots of Python or Ruby libraries that simply say you don&#8217;t have to know anything about Solr, just install this code and you get full text search! This works in the same way as using the default Mysql or Apache configs works, nowhere near as well as if you get your hands dirty even a little. Some of the ruby gems even ship the Solr jar file in the gem. Now you don&#8217;t even need to know Solr exists. You take a generic configuration and run it using a rake task behind which is some unknown Java application server. Good luck debugging that when it goes wrong, that&#8217;s one hell of a leeky abstraction.</p>
<p>In better news I&#8217;ve now found two excellent Solr libraries, one&#8217;s that start with the assumption that you know what you&#8217;re doing or happy to learn about the tools you&#8217;re using. All you really want from a library is a good <span class="caps">API</span> that maps to how you write in that language.</p>
<h2>Delsolr (Ruby)</h2>
<p>The <a href="http://delsolr.rubyforge.org/">delsolr</a> <span class="caps">API</span> is beautiful. It seemlessly merges the worlds of Ruby and Solr in a way that&#8217;s easy to write and easy to guess. It&#8217;s also clever, the design accepts that new features might be added to Solr before the library is updated or that the library might not support every usecase or option. In these cases you can still pass information through to Solr directly.</p>
<p>Solr&#8217;s interface is based around URLs, so any library is really just giving you an interface to creating those URLs.Writing the following in Ruby:</p>
<pre>rsp = solr.query('standard',
               :query =&gt; '*:*',
               :filters =&gt; {:status =&gt; 'Active'},
               :facets =&gt; [{:field =&gt; 'project'}]
    ])</pre>
<p>Results in the following <span class="caps">URL</span>:</p>
<pre>/select?q=*:*&amp;wt=ruby&amp;facet=true&amp;facet.field=status&amp;facet.field=name&amp;fq=status:Active</pre>
<p>If you already know Solr and how to construct URLs for searches by hand you&#8217;ll immediately get the Ruby code. You can probably even guess how to pass other params like sort or order.</p>
<p>Another nice touch is that you can use either hashes or Lucene search syntax for each attribute. So:</p>
<pre>:filters =&gt; {:status =&gt; 'Active'}</pre>
<p>Is the same as:</p>
<pre>:filters =&gt; 'status:Active'</pre>
<h2>Sunburnt (Python)</h2>
<p><a href="http://blog.timetric.com/2010/02/08/sunburnt-a-python-solr-interface">Sunburnt</a> is a python Solr interface from the nice folks at <a href="http://timetric.com">Timetric</a>. I&#8217;ve not had chance to use this library in anger as it was released after I&#8217;d dont quite a bit of python-solr work in an old job but I&#8217;d definately use it now. The <span class="caps">API</span> looks like:</p>
<pre>rsp = solr.query('*:*').filter(status='Active').facet_by('project').execute()</pre>
<p>It&#8217;s based around chaining so again you can probably guess how to make further queries from even this simple example.</p>
<p>Both Sunburnt and Delsolr also support adding documents to the index.</p>
<h2>Uses</h2>
<p>Once you understand facets and the usefulness of filter queries you see lots of places where Solr is useful apart from text search. Lots of ecommerce operations use facetted search interfaces, I&#8217;m sure everyone has spent time clicking through nested heirachies and watching the numbers (showing the number of products) next to the links decrease? You can built these interfaces using <span class="caps">SQL</span> but it&#8217;s incredibly expensive and gets out of hand quickly. Caching only helps a bit due to the number of permutations in all but the smallest stores or simplest products. It&#8217;s a similar problem with tagging, it&#8217;s pretty easy to kill your database</p>
<p>But it&#8217;s not just things that have the word search in that you can map Solr to. Two good examples are Timetric (from whom the Sunburnt library comes from) and the <a href="http://www.guardian.co.uk/open-platform/blog/what-is-powering-the-content-api">Guardian Content <span class="caps">API</span></a>. Both of these present lots of read data straight from Solr with great success and less database killing performance issues. Solr can really be seen as a simple place to denormalise your data, one advantage being that it keeps your database schema clean.</p>
<h2>Learning More</h2>
<p>Solr could do with better documentation for beginners. The wiki is an excellent reference once you know how to write schema and configuration files but I think the getting started section sacrifices introducing configuration in favour of getting people searching quicker. The example schema and solrconfig files that ship with Solr are also amazingly useful references (officially the best commented <span class="caps">XML</span> I&#8217;ve ever seen) but also intimidating to beginners. The Drupal community appear to be writing some good docs that fill this gap though, here&#8217;s a few links that I&#8217;d recommend:</p>
<ul>
	<li><a href="http://www.drupalconnect.com/blog/steve/configuring-apache-solr-multi-core-drupal-and-tomcat-ubuntu-910">Step by step guide including Tomcat</a></li>
	<li><a href="http://synapticloop.com/tomes/solr/solr-tutorial/">Fantastic multi-part tutorial</a></li>
</ul>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2010/12/29/Heroku-for.../">
        Heroku For...
      </a>
    </h1>

    <span class="post-date">29 Dec 2010</span>

    <p>With the success of <a href="http://heroku.com">Heroku</a>, both in terms of the recent sale and the fact it&#8217;s awesome, it was always just a matter of time before other languages and frameworks got into the platform as a service game. Here&#8217;s all the one&#8217;s I know about so far, many of them in or entering beta testing at the moment. Any others I&#8217;m missing?</p>
<p><strong>Update</strong> Thanks for all the comments on here and on <a href="http://news.ycombinator.com/item?id=2050203">Hacker News</a>, I&#8217;ve updated this list with all the suggestions.</p>
<h2>Ruby</h2>
<ul>
	<li><a href="http://www.duostack.com/">Duostack</a></li>
</ul>
<h2>Python</h2>
<ul>
	<li><a href="http://www.ep.io/">ep.io</a></li>
	<li><a href="http://DjangoZoom.com/">Django Zoom</a></li>
	<li><a href="https://www.djangy.com/">Djangy</a></li>
	<li><a href="http://appengine.google.com/">Google Appengine</a></li>
	<li><a href="http://stable.io/">Stable</a></li>
</ul>
<h2><span class="caps">PHP</span></h2>
<ul>
	<li><a href="http://phpfog.com/">PHPFog</a></li>
	<li><a href="http://cloudcontrol.com">CloudControl</a></li>
</ul>
<h2>.<span class="caps">NET</span></h2>
<ul>
	<li><a href="http://appharbor.com/">AppHarbor</a></li>
	<li><a href="http://biaslogic.com/">biasLogic</a></li>
	<li><a href="http://moncai.com/">Moncai</a></li>
	<li><a href="http://microsoft.com/azure">Microsoft Azure</a></li>
</ul>
<h2>Java (<span class="caps">JVM</span>)</h2>
<ul>
	<li><a href="http://www.cloudbees.com">CloudBees</a> via the purchase of <a href="http://stax.net/">Stax</a></li>
	<li><a href="http://appengine.google.com/">Google Appengine</a></li>
	<li><a href="http://www.playapps.net/">Playapps</a> (Play framework only)</li>
</ul>
<h2>Node.js</h2>
<ul>
	<li><a href="http://www.nodejscloud.com/">NodeJSCloud</a></li>
	<li><a href="https://no.de/">Joyent SmartMachine</a></li>
	<li><a href="http://www.duostack.com/">Duostack</a></li>
	<li><a href="http://nodejitsu.com/">Nodejitsu</a></li>
</ul>
<h2>RingoJS</h2>
<ul>
	<li><a href="http://www.erbix.com/">Erbix</a></li>
</ul>
<h2>Multi Platform</h2>
<ul>
	<li><a href="http://kodingen.com/">Kodingen</a></li>
	<li><a href="http://dotcloud.com">DotCloud</a></li>
</ul>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2010/12/24/A-vagrant-ecosystem/">
        A Vagrant Ecosystem
      </a>
    </h1>

    <span class="post-date">24 Dec 2010</span>

    <p>As mentioned loudly and repeatedly on here and on Twitter I love <a href="http://vagrantup.com">vagrant</a>. While writing a chef cookbook to bootstrap my virtual machines I started thinking about how things around vagrant could help it be more useful. These might be things I&#8217;m going to do, or ideally get involved with others to do. If anyone has any other ideas, or suggestions please leave comments, I definately think this is the time for discussion.</p>
<h2>Baseboxes</h2>
<p>I don&#8217;t really want to have to maintain baseboxes but I want access to lots of them. I&#8217;m sure some people will want a <em>Ruby on Rails in a box</em> but all I really care about is having access to recent 32 and 63 bit vanilla linux distributions. I want a good source for trusted baseboxes. At the moment the approach is to look on the wiki, then look on the mailing list and then search the web, then create your own (even using <a href="https://github.com/jedi4ever/veewee">VeeWee</a> it&#8217;s still a little fiddly). I&#8217;ve managed to find good lucid, maverick and debian boxes, but have had problems with centos and a few others. Part of this is the rate of change recenty of both vagrant and now VirtualBox (both good things), part of it is the lack of reviews and shared experiences around baseboxes.</p>
<p>What I&#8217;d love to see is a single place where anyone can post a link to a basebox and vagrant users can come along and assign metadata about whether it worked and on what hardware, vagrant version, virtual box version, etc. It could even act as a tracker, counting downloads of boxes to gauge popularity.</p>
<h2>Templated Vagrantfiles</h2>
<p>As mentioned previously I have a chef cookbook I use to bootstrap all my new virtual machines. My process is therefore: <em>vagrant init</em>, make some manual changes to the Vagrantfile (or copy it from elsewhere), <em>vagrant up</em>. I&#8217;m lazy and want a nicer way to reuse Vagrantfiles or to script their creation.</p>
<p>I started out thinking that the ability to point the init command at a template and to provide context on the command line might be a good idea. Now I&#8217;m wondering whether we just need a command line application which allows for writing or modifying the Vagrantfile? Something like:</p>
<pre>vagrant config vm.provisioner=:chef_solo
vagrant config chef.recipe_url=http://cloud.github.com/downloads/garethr/chef-repo/cookbooks.tar.gz</pre>
<h2>Hosted cookbooks</h2>
<p>I dissed the idea of a <em>Ruby on Rails in a box</em> basebox above but I still want to be able to let people more easily share custom configuration for specialist applications. But what I&#8217;d prefer would be people sharing packaged cookbooks, a bit like I&#8217;ve done for my default virtual machine setup. Again the beauty of this is it&#8217;s pretty much just sharing a <span class="caps">URL</span> to a tar.gz file. This makes more sense to me at least than random people connecting to my chef server (I shouldn&#8217;t know about their machines) and lowers the barrier to entry for those not interested in hosting their own chef server or using the opscode platform for local virtual machines.</p>
<p>I&#8217;m also not talking here about just sharing individual cookbooks like <a href="http://cookbooks.opscode.com/">cookbooks.opscode.com</a>, but rather a packaged collection of individual recipes designed for a specific purpose. A fully working solr instance, a django application server using apache/mod_wsgi, etc.</p>
<p>Many of the points about baseboxes above would work here too I think. Having a good community resource which points to lots of cookbook tar files. Allowing people to feed back about what works for them. I&#8217;ve mainly taked about Chef here as that&#8217;s what vagrant initially shipped with, with the puppet provisioner now ready to go with would stand for puppet manifests too.</p>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2010/12/20/Smoke-testing-with-cucumber-on-sysadvent/">
        Smoke Testing With Cucumber On Sysadvent
      </a>
    </h1>

    <span class="post-date">20 Dec 2010</span>

    <p>I wrote a quick article last week for the excellent <a href="http://sysadvent.blogspot.com">sysadvent</a> advent calendar, <a href="http://sysadvent.blogspot.com/2010/12/day-17-smoke-testing-deployments-using.html">Smoke Testing Deployments with Cucumber</a> talks a bit more about using a few of my favourite tools to check whether a deployment just broke anything important.</p>
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page15">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page13">Newer</a>
    
  
</div>
    </div>

  </body>
</html>
